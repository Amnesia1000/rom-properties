PROJECT(librpbase-tests)

# Top-level src directory.
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/../..)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR}/../..)

# ZLIB and libpng are checked in the top-level CMakeLists.txt.

IF(NOT WIN32)
	IF(ENABLE_DECRYPTION)
		FIND_LIBRARY(Nettle REQUIRED)
	ENDIF(ENABLE_DECRYPTION)
ENDIF(NOT WIN32)

IF(ENABLE_DECRYPTION)
	# AesCipher test.
	ADD_EXECUTABLE(AesCipherTest
		gtest_init.cpp
		AesCipherTest.cpp
		)
	TARGET_LINK_LIBRARIES(AesCipherTest PRIVATE rpbase)
	TARGET_LINK_LIBRARIES(AesCipherTest PRIVATE gtest)
	IF(WIN32)
		TARGET_LINK_LIBRARIES(AesCipherTest PRIVATE win32common)
		TARGET_LINK_LIBRARIES(AesCipherTest PRIVATE advapi32)
	ENDIF(WIN32)
	IF(NETTLE_LIBRARY)
		TARGET_LINK_LIBRARIES(AesCipherTest PRIVATE ${NETTLE_LIBRARY})
		TARGET_INCLUDE_DIRECTORIES(AesCipherTest PRIVATE ${NETTLE_INCLUDE_DIRS})
	ENDIF(NETTLE_LIBRARY)
	DO_SPLIT_DEBUG(AesCipherTest)
	SET_WINDOWS_SUBSYSTEM(AesCipherTest CONSOLE)
	ADD_TEST(NAME AesCipherTest COMMAND AesCipherTest)
ENDIF(ENABLE_DECRYPTION)

# TextFuncsTest.
ADD_EXECUTABLE(TextFuncsTest
	gtest_init.cpp
	TextFuncsTest.cpp
	TextFuncsTest_data.hpp
	)
IF(WIN32)
	TARGET_LINK_LIBRARIES(TextFuncsTest PRIVATE win32common)
ENDIF(WIN32)
TARGET_LINK_LIBRARIES(TextFuncsTest PRIVATE rpbase)
TARGET_LINK_LIBRARIES(TextFuncsTest PRIVATE gtest)
DO_SPLIT_DEBUG(TextFuncsTest)
SET_WINDOWS_SUBSYSTEM(TextFuncsTest CONSOLE)
ADD_TEST(NAME TextFuncsTest COMMAND TextFuncsTest)

# ByteswapTest.
ADD_EXECUTABLE(ByteswapTest
	gtest_init.cpp
	ByteswapTest.cpp
	ByteswapTest_data.hpp
	)
IF(WIN32)
	TARGET_LINK_LIBRARIES(ByteswapTest PRIVATE win32common)
ENDIF(WIN32)
TARGET_LINK_LIBRARIES(ByteswapTest PRIVATE rpbase)
TARGET_LINK_LIBRARIES(ByteswapTest PRIVATE gtest)
DO_SPLIT_DEBUG(ByteswapTest)
SET_WINDOWS_SUBSYSTEM(ByteswapTest CONSOLE)
ADD_TEST(NAME ByteswapTest COMMAND ByteswapTest "--gtest_filter=-*benchmark*")
